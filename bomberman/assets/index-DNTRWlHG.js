var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{p as s}from"./phaser-DJc9ez-r.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class i extends s.Scene{constructor(){super("Boot")}create(){this.scene.start("Preloader")}}class a extends s.Scene{constructor(){super("Preloader")}preload(){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"LOADING GAME ...").setFontFamily('"BitBold", "Tahoma"').setFontSize(15).setColor("white").setStroke("black",2.5).setOrigin(.5,.5),this.load.tilemapTiledJSON("world","/game/map/tilemap.json"),this.load.image("tilemap","/game/map/hard-wall.png"),this.load.image("door","/game/images/door.png"),this.load.image("bomb-up","/game/images/power-up/bomb-up.png"),this.load.image("fire-up","/game/images/power-up/fire-up.png"),this.load.image("flame-pass","/game/images/power-up/flame-pass.png"),this.load.image("remote-control","/game/images/power-up/flame-pass.png"),this.load.image("remote-control","/game/images/power-up/remote-control.png"),this.load.image("wall-pass","/game/images/power-up/wall-pass.png"),this.load.image("speed-up","/game/images/power-up/speed-up.png"),this.load.image("menu-title","/game/images/menu-title.png"),this.load.spritesheet("bomberman-move","/game/sprites/player/walking.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("bomberman-dead","/game/sprites/player/killing.png",{frameWidth:16,frameHeight:21}),this.load.spritesheet("bomb","/game/sprites/bomb/bomb.png",{frameWidth:17,frameHeight:18}),this.load.spritesheet("wall","/game/sprites/wall/wall.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("wall-explosion","/game/sprites/wall/wall-explosion.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("ballom","/game/sprites/enemies/ballom.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("onil","/game/sprites/enemies/onil.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("minvo","/game/sprites/enemies/minvo.png",{frameWidth:17,frameHeight:16}),this.load.spritesheet("dahl","/game/sprites/enemies/dahl.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("ovape","/game/sprites/enemies/ovape.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("pass","/game/sprites/enemies/pass.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("pontan","/game/sprites/enemies/pontan.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("explosion-center","/game/sprites/bomb/explosion/explosion-center.png",{frameWidth:18,frameHeight:18}),this.load.spritesheet("explosion-upper-lenght","/game/sprites/bomb/explosion/explosion-upper-lenght.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("explosion-lower-lenght","/game/sprites/bomb/explosion/explosion-lower-lenght.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("explosion-right-lenght","/game/sprites/bomb/explosion/explosion-right-lenght.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("explosion-left-lenght","/game/sprites/bomb/explosion/explosion-left-lenght.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("explosion-extension-horizontal","/game/sprites/bomb/explosion/explosion-extension-horizontal.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("explosion-extension-vertical","/game/sprites/bomb/explosion/explosion-extension-vertical.png",{frameWidth:18,frameHeight:16}),this.load.spritesheet("destroy-enemy","/game/sprites/enemies/destroy-enemy/destroy-enemy.png",{frameWidth:14,frameHeight:16}),this.load.audio("stage-theme","/game/music/stage/stage-theme.mp3"),this.load.audio("bonus-theme","/game/music/stage/bonus-theme.mp3"),this.load.audio("level-start","/game/music/stage/level-start.mp3"),this.load.audio("level-complete","/game/music/stage/level-complete.mp3"),this.load.audio("just-died","/game/music/character/just-died.mp3"),this.load.audio("explosion","/game/music/bomb/explosion.mp3"),this.load.audio("find-the-door","/game/music/character/find_the_door.mp3"),this.load.audio("game-over","/game/music/stage/game-over.mp3"),this.load.audio("menu-audio","/game/music/stage/title-screen.mp3"),this.load.audio("walking-y","/game/music/character/walk.mp3"),this.load.audio("walking-x","/game/music/character/walk-2.mp3"),this.load.audio("put-bomb","/game/music/bomb/put-bomb.wav"),this.load.audio("power-up","/game/music/character/power-up.wav"),this.load.audio("lose","/game/music/character/lose.wav"),this.load.audio("last-enemy","/game/music/enemy/last-enemy.wav")}create(){this.scene.start("MainMenu")}}var o=(e=>(e[e.ONE=0]="ONE",e[e.TWO=1]="TWO",e[e.THREE=2]="THREE",e[e.FOUR=3]="FOUR",e[e.FIVE=4]="FIVE",e[e.FINAL_BONUS=5]="FINAL_BONUS",e))(o||{}),n=(e=>(e[e.START=0]="START",e[e.RESTART=1]="RESTART",e[e.LOADED_GAME=2]="LOADED_GAME",e[e.GAME_OVER=3]="GAME_OVER",e[e.NEXT_STAGE=4]="NEXT_STAGE",e[e.COMPLETED=5]="COMPLETED",e))(n||{});const r=()=>({stage:o.ONE,lives:1,time:600,status:n.START,totalScore:0,stageScore:0,powerUps:[0]});class h{constructor(e){t(this,"_saveGameControl"),this._setUpControls(e)}_setUpControls(e){e.input.keyboard&&(this._saveGameControl=e.input.keyboard.addKey(s.Input.Keyboard.KeyCodes.S))}get saveGameControl(){return this._saveGameControl}}var l=(e=>(e.HIGHEST_SCORE_KEY="_bombermanJS_highest_score",e.SAVED_GAME="_bombermanJS_saved_game",e))(l||{});class c{constructor({scene:e,gameStage:s,player:i,enemiesGroup:a,mapManager:o}){t(this,"_scene"),t(this,"_gameStage"),t(this,"_player"),t(this,"_enemiesGroup"),t(this,"_mapManager"),t(this,"_controlsManager"),this._scene=e,this._gameStage=s,this._player=i,this._enemiesGroup=a,this._mapManager=o,this._controlsManager=new h(e)}static getLoadedGame(){const e=localStorage.getItem(l.SAVED_GAME);return e?JSON.parse(e):null}addControlsListener(){var e,t,s;if((null==(e=this._player.body)?void 0:e.enable)&&(null==(s=null==(t=this._controlsManager)?void 0:t.saveGameControl)?void 0:s.isDown)){const e=this._scene.add.text(850,22,"SAVING GAME ...").setFontFamily('"BitBold", "Tahoma"').setFontSize(15).setColor("white").setStroke("black",2.5).setScrollFactor(0,0);this._scene.time.addEvent({delay:2e3,callback:()=>e.destroy(!0),callbackScope:this}),this._saveGame()}}_saveGame(){const e={...this._gameStage};e.status=n.LOADED_GAME;const t={gameStage:e,player:this._player.getSavedState(),enemies:this._enemiesGroup.getSavedState(),map:this._mapManager.getSavedState()};localStorage.setItem(l.SAVED_GAME,JSON.stringify(t))}}class d extends s.Scene{constructor(){super("MainMenu")}create(){this.cameras.main.backgroundColor=Phaser.Display.Color.HexStringToColor("#000000"),this.add.sprite(this.cameras.main.centerX,this.cameras.main.centerY-80,"menu-title").setScale(2.4);const e=this.add.text(this.cameras.main.centerX-180,this.cameras.main.centerY+120,"START").setFontFamily('"BitBold", "Tahoma"').setFontSize(20).setColor("white").setStroke("black",2.5).setInteractive({useHandCursor:!0}).on(Phaser.Input.Events.POINTER_OVER,(()=>{e.setFontSize(21).setColor("#bdbd16")}),this).on(Phaser.Input.Events.POINTER_OUT,(()=>{e.setFontSize(20).setColor("white")}),this).on(Phaser.Input.Events.POINTER_DOWN,(()=>{this.sound.stopAll();const e=r();this.scene.start("ChangeStage",e)}),this),t=this.add.text(this.cameras.main.centerX+50,this.cameras.main.centerY+120,"CONTINUE").setFontFamily('"BitBold", "Tahoma"').setFontSize(20).setColor("white").setStroke("black",2.5).setInteractive({useHandCursor:!0}).on(Phaser.Input.Events.POINTER_OVER,(()=>{t.setFontSize(21).setColor("#bdbd16")}),this).on(Phaser.Input.Events.POINTER_OUT,(()=>{t.setFontSize(20).setColor("white")}),this).on(Phaser.Input.Events.POINTER_DOWN,(()=>{const e=c.getLoadedGame();e&&this.scene.start("ChangeStage",e.gameStage)}),this);this.add.text(this.cameras.main.centerX-180,this.cameras.main.centerY+150,"TOP").setFontFamily('"BitBold", "Tahoma"').setFontSize(20).setColor("white").setStroke("black",2.5);const i=localStorage.getItem(l.HIGHEST_SCORE_KEY)??0;this.add.text(this.cameras.main.centerX+50,this.cameras.main.centerY+150,i.toString()).setFontFamily('"BitBold", "Tahoma"').setFontSize(20).setColor("white").setStroke("black",2.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+220,"This little game was born as an inspiration \n to learn about the awesome universe of the Web Game Development").setOrigin(.5).setAlign("center").setFontFamily('"BitBold", "Tahoma"').setFontSize(12).setColor("white").setStroke("black",2.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+250,`Phaser ${s.VERSION} ❤️`).setOrigin(.5).setFontFamily('"BitBold", "Tahoma"').setFontSize(13).setColor("#bdbd16").setStroke("#8e001c",2.5),this.sound.play("menu-audio",{loop:!0,volume:.5})}}function p(e){return Math.abs(Math.floor(e))}function m(e,t){return Math.random()*(t-e)+e}function u(e,t){return Math.floor(m(e,t+1))}function y(e,t,s,i){const a=Math.pow;return Math.sqrt(a(e-s,2)+a(t-i,2))}function _(e,t,s=1){if(e>360||e<0)throw new Error(`Expected hue 0-360 range, got \`${e}\``);if(t>100||t<0)throw new Error(`Expected lightness 0-100 range, got \`${t}\``);if(s>1||s<0)throw new Error(`Expected alpha 0-1 range, got \`${s}\``);return`hsla(${e}, 100%, ${t}%, ${s})`}const g=e=>{if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"===Object.prototype.toString.call(e)}return!1},x=["__proto__","constructor","prototype"],b=(...e)=>e.reduce(((e,t)=>(Object.keys(t).forEach((s=>{x.includes(s)||(Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=t[s]:g(e[s])&&g(t[s])?e[s]=b(e[s],t[s]):e[s]=t[s])})),e)),{});class f{constructor({x:e,y:s,ctx:i,hue:a,decay:o,gravity:n,friction:r,brightness:h,flickering:l,lineWidth:c,explosionLength:d}){for(t(this,"x"),t(this,"y"),t(this,"ctx"),t(this,"hue"),t(this,"friction"),t(this,"gravity"),t(this,"flickering"),t(this,"lineWidth"),t(this,"explosionLength"),t(this,"angle"),t(this,"speed"),t(this,"brightness"),t(this,"coordinates",[]),t(this,"decay"),t(this,"alpha",1),this.x=e,this.y=s,this.ctx=i,this.hue=a,this.gravity=n,this.friction=r,this.flickering=l,this.lineWidth=c,this.explosionLength=d,this.angle=m(0,2*Math.PI),this.speed=u(1,10),this.brightness=u(h.min,h.max),this.decay=m(o.min,o.max);this.explosionLength--;)this.coordinates.push([e,s])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&e()}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth,this.ctx.fillStyle=_(this.hue,this.brightness,this.alpha),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=_(this.hue,this.flickering?m(0,this.brightness):this.brightness,this.alpha),this.ctx.stroke()}}class v{constructor(e,s){t(this,"active",!1),t(this,"x"),t(this,"y"),this.options=e,this.canvas=s,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this)}get mouseOptions(){return this.options.mouse}mount(){this.canvas.addEventListener("pointerdown",this.pointerDown),this.canvas.addEventListener("pointerup",this.pointerUp),this.canvas.addEventListener("pointermove",this.pointerMove)}unmount(){this.canvas.removeEventListener("pointerdown",this.pointerDown),this.canvas.removeEventListener("pointerup",this.pointerUp),this.canvas.removeEventListener("pointermove",this.pointerMove)}usePointer(e,t){const{click:s,move:i}=this.mouseOptions;(s||i)&&(this.x=e.pageX-this.canvas.offsetLeft,this.y=e.pageY-this.canvas.offsetTop,this.active=t)}pointerDown(e){this.usePointer(e,this.mouseOptions.click)}pointerUp(e){this.usePointer(e,!1)}pointerMove(e){this.usePointer(e,this.active)}}class S{constructor(){t(this,"hue"),t(this,"rocketsPoint"),t(this,"opacity"),t(this,"acceleration"),t(this,"friction"),t(this,"gravity"),t(this,"particles"),t(this,"explosion"),t(this,"mouse"),t(this,"boundaries"),t(this,"sound"),t(this,"delay"),t(this,"brightness"),t(this,"decay"),t(this,"flickering"),t(this,"intensity"),t(this,"traceLength"),t(this,"traceSpeed"),t(this,"lineWidth"),t(this,"lineStyle"),t(this,"autoresize"),this.autoresize=!0,this.lineStyle="round",this.flickering=50,this.traceLength=3,this.traceSpeed=10,this.intensity=30,this.explosion=5,this.gravity=1.5,this.opacity=.5,this.particles=50,this.friction=.95,this.acceleration=1.05,this.hue={min:0,max:360},this.rocketsPoint={min:50,max:50},this.lineWidth={explosion:{min:1,max:3},trace:{min:1,max:2}},this.mouse={click:!1,move:!1,max:1},this.delay={min:30,max:60},this.brightness={min:50,max:80},this.decay={min:.015,max:.03},this.sound={enabled:!1,files:["explosion0.mp3","explosion1.mp3","explosion2.mp3"],volume:{min:4,max:8}},this.boundaries={debug:!1,height:0,width:0,x:50,y:50}}update(e){Object.assign(this,b(this,e))}}class w{constructor(e,s){t(this,"tick",0),t(this,"rafId",0),t(this,"fps",60),t(this,"tolerance",.1),t(this,"now"),this.options=e,this.render=s}mount(){this.now=performance.now();const e=1e3/this.fps,t=s=>{this.rafId=requestAnimationFrame(t);const i=s-this.now;i>=e-this.tolerance&&(this.render(),this.now=s-i%e,this.tick+=i*(this.options.intensity*Math.PI)/1e3)};this.rafId=requestAnimationFrame(t)}unmount(){cancelAnimationFrame(this.rafId)}}class E{constructor(e,s,i){t(this,"resizer"),this.options=e,this.updateSize=s,this.container=i}mount(){if(!this.resizer){const e=function(e){let t;return(...s)=>{t&&clearTimeout(t),t=setTimeout((()=>e(...s)),100)}}((()=>this.updateSize()));this.resizer=new ResizeObserver(e)}this.options.autoresize&&this.resizer.observe(this.container)}unmount(){this.resizer&&this.resizer.unobserve(this.container)}}class P{constructor(e){t(this,"buffers",[]),t(this,"audioContext"),t(this,"onInit",!1),this.options=e,this.init()}get isEnabled(){return this.options.sound.enabled}get soundOptions(){return this.options.sound}init(){!this.onInit&&this.isEnabled&&(this.onInit=!0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.loadSounds())}async loadSounds(){for(const e of this.soundOptions.files){const t=await(await fetch(e)).arrayBuffer();this.audioContext.decodeAudioData(t).then((e=>{this.buffers.push(e)})).catch((e=>{throw e}))}}play(){if(this.isEnabled&&this.buffers.length){const e=this.audioContext.createBufferSource(),t=this.buffers[u(0,this.buffers.length-1)],s=this.audioContext.createGain();e.buffer=t,s.gain.value=m(this.soundOptions.volume.min/100,this.soundOptions.volume.max/100),s.connect(this.audioContext.destination),e.connect(s),e.start(0)}else this.init()}}class M{constructor({x:e,y:s,dx:i,dy:a,ctx:o,hue:n,speed:r,traceLength:h,acceleration:l}){for(t(this,"x"),t(this,"y"),t(this,"sx"),t(this,"sy"),t(this,"dx"),t(this,"dy"),t(this,"ctx"),t(this,"hue"),t(this,"speed"),t(this,"acceleration"),t(this,"traceLength"),t(this,"totalDistance"),t(this,"angle"),t(this,"brightness"),t(this,"coordinates",[]),t(this,"currentDistance",0),this.x=e,this.y=s,this.sx=e,this.sy=s,this.dx=i,this.dy=a,this.ctx=o,this.hue=n,this.speed=r,this.traceLength=h,this.acceleration=l,this.totalDistance=y(e,s,i,a),this.angle=Math.atan2(a-s,i-e),this.brightness=u(50,70);this.traceLength--;)this.coordinates.push([e,s])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.acceleration;const t=Math.cos(this.angle)*this.speed,s=Math.sin(this.angle)*this.speed;this.currentDistance=y(this.sx,this.sy,this.x+t,this.y+s),this.currentDistance>=this.totalDistance?e(this.dx,this.dy,this.hue):(this.x+=t,this.y+=s)}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=_(this.hue,this.brightness),this.ctx.stroke()}}class T{constructor(e,s={}){t(this,"target"),t(this,"container"),t(this,"canvas"),t(this,"ctx"),t(this,"width"),t(this,"height"),t(this,"traces",[]),t(this,"explosions",[]),t(this,"waitStopRaf"),t(this,"running",!1),t(this,"opts"),t(this,"sound"),t(this,"resize"),t(this,"mouse"),t(this,"raf"),this.target=e,this.container=e,this.opts=new S,this.createCanvas(this.target),this.updateOptions(s),this.sound=new P(this.opts),this.resize=new E(this.opts,this.updateSize.bind(this),this.container),this.mouse=new v(this.opts,this.canvas),this.raf=new w(this.opts,this.render.bind(this))}get isRunning(){return this.running}get version(){return"2.10.8"}get currentOptions(){return this.opts}start(){this.running||(this.canvas.isConnected||this.createCanvas(this.target),this.running=!0,this.resize.mount(),this.mouse.mount(),this.raf.mount())}stop(e=!1){this.running&&(this.running=!1,this.resize.unmount(),this.mouse.unmount(),this.raf.unmount(),this.clear(),e&&this.canvas.remove())}async waitStop(e){if(this.running)return new Promise((t=>{this.waitStopRaf=()=>{this.waitStopRaf&&(requestAnimationFrame(this.waitStopRaf),!this.traces.length&&!this.explosions.length&&(this.waitStopRaf=null,this.stop(e),t()))},this.waitStopRaf()}))}pause(){this.running=!this.running,this.running?this.raf.mount():this.raf.unmount()}clear(){this.ctx&&(this.traces=[],this.explosions=[],this.ctx.clearRect(0,0,this.width,this.height))}launch(e=1){for(let t=0;t<e;t++)this.createTrace();this.waitStopRaf||(this.start(),this.waitStop())}updateOptions(e){this.opts.update(e)}updateSize({width:e=this.container.clientWidth,height:t=this.container.clientHeight}={}){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.updateBoundaries({...this.opts.boundaries,width:e,height:t})}updateBoundaries(e){this.updateOptions({boundaries:e})}createCanvas(e){e instanceof HTMLCanvasElement?(e.isConnected||document.body.append(e),this.canvas=e):(this.canvas=document.createElement("canvas"),this.container.append(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.updateSize()}render(){if(!this.ctx||!this.running)return;const{opacity:e,lineStyle:t,lineWidth:s}=this.opts;this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle=`rgba(0, 0, 0, ${e})`,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="lighter",this.ctx.lineCap=t,this.ctx.lineJoin="round",this.ctx.lineWidth=m(s.trace.min,s.trace.max),this.initTrace(),this.drawTrace(),this.drawExplosion()}createTrace(){const{hue:e,rocketsPoint:t,boundaries:s,traceLength:i,traceSpeed:a,acceleration:o,mouse:n}=this.opts;this.traces.push(new M({x:this.width*u(t.min,t.max)/100,y:this.height,dx:this.mouse.x&&n.move||this.mouse.active?this.mouse.x:u(s.x,s.width-2*s.x),dy:this.mouse.y&&n.move||this.mouse.active?this.mouse.y:u(s.y,.5*s.height),ctx:this.ctx,hue:u(e.min,e.max),speed:a,acceleration:o,traceLength:p(i)}))}initTrace(){if(this.waitStopRaf)return;const{delay:e,mouse:t}=this.opts;(this.raf.tick>u(e.min,e.max)||this.mouse.active&&t.max>this.traces.length)&&(this.createTrace(),this.raf.tick=0)}drawTrace(){let e=this.traces.length;for(;e--;)this.traces[e].draw(),this.traces[e].update(((t,s,i)=>{this.initExplosion(t,s,i),this.sound.play(),this.traces.splice(e,1)}))}initExplosion(e,t,s){const{particles:i,flickering:a,lineWidth:o,explosion:n,brightness:r,friction:h,gravity:l,decay:c}=this.opts;let d=p(i);for(;d--;)this.explosions.push(new f({x:e,y:t,ctx:this.ctx,hue:s,friction:h,gravity:l,flickering:u(0,100)<=a,lineWidth:m(o.explosion.min,o.explosion.max),explosionLength:p(n),brightness:r,decay:c}))}drawExplosion(){let e=this.explosions.length;for(;e--;)this.explosions[e].draw(),this.explosions[e].update((()=>{this.explosions.splice(e,1)}))}}class O extends s.Scene{constructor(){super("ChangeStage"),t(this,"_gameStage")}init(e){this._gameStage=e}create(){var e;if(this.sound.stopAll(),this.cameras.main.backgroundColor=Phaser.Display.Color.HexStringToColor("#000000"),this._gameStage)switch(null==(e=this._gameStage)?void 0:e.status){case n.START:case n.RESTART:this._gameStage=r(),this._prepareUI({text:this._getStageText(),delay:4,soundKey:"level-start",sceneKey:"Game"});break;case n.LOADED_GAME:this._prepareUI({text:this._getStageText(),delay:4,soundKey:"level-start",sceneKey:"Game"});break;case n.GAME_OVER:localStorage.clear(),this._prepareUI({text:"GAME OVER",delay:7,soundKey:"game-over",sceneKey:"MainMenu"});break;case n.NEXT_STAGE:this._gameStage.stage++,this._prepareUI({text:this._getStageText(),delay:4,soundKey:"level-start",sceneKey:"Game"});break;case n.COMPLETED:localStorage.clear(),this._prepareUI({text:"Amazing! \n Thanks for playing!",delay:10,soundKey:"level-complete",sceneKey:"MainMenu"})}}_prepareUI(e){const{text:t,delay:s,soundKey:i}=e;this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,t).setFontFamily('"BitBold", "Tahoma"').setFontSize(15).setColor("white").setStroke("black",2.5).setOrigin(.5).setAlign("center"),this.sound.play(i);const a=this.time.addEvent({delay:1e3,repeat:s,callback:()=>{var t;const{repeatCount:s}=a;s<=0&&(null==(t=this._gameStage)?void 0:t.stage)!==o.FINAL_BONUS&&this.scene.start(e.sceneKey,this._gameStage)},callbackScope:this})}_getStageText(){var e,t;if((null==(e=this._gameStage)?void 0:e.stage)===o.FINAL_BONUS){const e=document.body;return new T(e,{}).start(),"Саша! Поздравляем тебя с днем рождения!"}return`STAGE ${((null==(t=this._gameStage)?void 0:t.stage)??0)+1}`}}class A{constructor(e){t(this,"_cursorKeys"),t(this,"_putBombControl"),t(this,"_exploitBombControl"),this._setUpControls(e)}_setUpControls(e){e.input.keyboard&&(this._cursorKeys=e.input.keyboard.createCursorKeys(),this._putBombControl=e.input.keyboard.addKey(s.Input.Keyboard.KeyCodes.SPACE),this._exploitBombControl=e.input.keyboard.addKey(s.Input.Keyboard.KeyCodes.SHIFT))}get cursorKeys(){return this._cursorKeys}get putBombControl(){return this._putBombControl}get exploitBombControl(){return this._exploitBombControl}}var B=(e=>(e.UP="up",e.LEFT="left",e.RIGH="right",e.DOWN="down",e.IDLE="idle",e))(B||{});class L extends s.Physics.Arcade.Sprite{constructor({scene:e,x:s,y:i,bombGroup:a,gameStage:o,savedGame:n}){super(e,s,i,"bomberman-move"),t(this,"_direction"),t(this,"_controlsManager"),t(this,"_speed"),t(this,"_hasWallPassPowerUp"),t(this,"_hasBombPassPowerUp"),t(this,"_hasFlamePassPowerUp"),t(this,"_lastTilePassedPosition"),t(this,"_savedGame"),t(this,"_bombGroup"),this._direction=B.LEFT,this._speed=150,this._hasWallPassPowerUp=!1,this._hasBombPassPowerUp=!1,this._hasFlamePassPowerUp=!1,this._lastTilePassedPosition={x:s,y:i},this._bombGroup=a,this._savedGame=n,e.add.existing(this),e.physics.add.existing(this),this.setScale(2),this.setBodySize(this.width-5,this.height),this._validateSavedPlayer(o),this._setUpControls(),this._setUpAnimations(),this.scene.cameras.main.startFollow(this)}_validateSavedPlayer(e){if(e.status===n.LOADED_GAME&&this._savedGame){const{player:e}=this._savedGame;this.setPosition(e.x,e.y)}}_setUpControls(){this._controlsManager=new A(this.scene)}_setUpAnimations(){this.anims.create({key:B.LEFT,frames:this.anims.generateFrameNumbers("bomberman-move",{frames:[0,1,2]}),frameRate:10,repeat:-1}),this.anims.create({key:B.RIGH,frames:this.anims.generateFrameNumbers("bomberman-move",{frames:[3,4,5]}),frameRate:10,repeat:-1}),this.anims.create({key:B.DOWN,frames:this.anims.generateFrameNumbers("bomberman-move",{frames:[6,7,8]}),frameRate:10,repeat:-1}),this.anims.create({key:B.UP,frames:this.anims.generateFrameNumbers("bomberman-move",{frames:[9,10,11]}),frameRate:10,repeat:-1}),this.anims.create({key:"die",frames:this.anims.generateFrameNumbers("bomberman-dead"),frameRate:8})}_playSoundByKey(e){let t=this.scene.sound.get(e);null===t&&(t=this.scene.sound.add(e)),t.isPlaying||t.play({volume:.4})}_playAnimationByKey(e,t){if(this._direction!=e)return this.play(e),void(this._direction=e);this.anims.isPlaying||this.anims.nextFrame(),this._playSoundByKey(t)}addControlsListener(){var e,t,s,i,a,o,n,r,h,l,c,d,p;if(null==(e=this.body)?void 0:e.enable){if(this.setVelocity(0),null==(s=null==(t=this._controlsManager)?void 0:t.cursorKeys)?void 0:s.right.isDown)return this.setVelocityX(this._speed),void this._playAnimationByKey(B.RIGH,"walking-x");if(null==(a=null==(i=this._controlsManager)?void 0:i.cursorKeys)?void 0:a.left.isDown)return this.setVelocityX(-this._speed),void this._playAnimationByKey(B.LEFT,"walking-x");if(null==(n=null==(o=this._controlsManager)?void 0:o.cursorKeys)?void 0:n.up.isDown)return this.setVelocityY(-this._speed),void this._playAnimationByKey(B.UP,"walking-y");if(null==(h=null==(r=this._controlsManager)?void 0:r.cursorKeys)?void 0:h.down.isDown)return this.setVelocityY(this._speed),void this._playAnimationByKey(B.DOWN,"walking-y");(null==(c=null==(l=this._controlsManager)?void 0:l.putBombControl)?void 0:c.isDown)&&this._bombGroup.putBomb(this._lastTilePassedPosition.x,this._lastTilePassedPosition.y),(null==(p=null==(d=this._controlsManager)?void 0:d.exploitBombControl)?void 0:p.isDown)&&this._bombGroup.exploitNextBomb(),this._direction!=B.IDLE&&(this.stop(),this._direction=B.IDLE)}}kill(){this.setVelocity(0),this.disableBody(!1),this.setImmovable(!0),this.scene.game.sound.stopAll(),this.scene.sound.play("lose"),this.play({key:"die",hideOnComplete:!0}).on(s.Animations.Events.ANIMATION_COMPLETE,(()=>{this.scene.sound.play("just-died")}),this)}validateTileOverlap(e){if(e.body&&this.body){const t=Math.round(this.body.center.x),s=Math.round(this.body.center.y),i=Math.floor(e.body.center.x),a=Math.floor(e.body.center.y),o=Math.abs(t-i),n=Math.abs(s-a);return o<=10&&n<=10}return!1}getSavedState(){var e,t;return{x:(null==(e=this.body)?void 0:e.center.x)??0,y:(null==(t=this.body)?void 0:t.center.y)??0}}get speed(){return this._speed}set speed(e){this._speed=e}get hasWallPassPowerUp(){return this._hasWallPassPowerUp}set hasWallPassPowerUp(e){this._hasWallPassPowerUp=e}get hasBombPassPowerUp(){return this._hasBombPassPowerUp}set hasBombPassPowerUp(e){this._hasBombPassPowerUp=e}get hasFlamePassPowerUp(){return this._hasFlamePassPowerUp}set hasFlamePassPowerUp(e){this._hasFlamePassPowerUp=e}get lastTilePassedPosition(){return this._lastTilePassedPosition}set lastTilePassedPosition(e){this._lastTilePassedPosition=e}}class U extends s.Physics.Arcade.Sprite{constructor({scene:e,x:t,y:s}){super(e,t,s,"bomb"),this.setScale(1.8),this._setUpAnimations(),this.play("wait")}_setUpAnimations(){this.anims.create({key:"wait",frames:this.anims.generateFrameNumbers("bomb"),frameRate:3,repeat:-1})}}class G extends s.Physics.Arcade.Sprite{constructor({scene:e,x:t,y:i,textureKey:a,isVisible:o}){super(e,t,i,a),e.physics.add.existing(this),this.setScale(2.4),this.setVisible(o),this.setImmovable(!0),this.setBodySize(this.width-5,this.height-5),this.play(a).once(s.Animations.Events.ANIMATION_COMPLETE,(()=>{this.destroy(!0)}))}}class C extends s.Physics.Arcade.Group{constructor({world:e,scene:s,wallBuilderManager:i}){super(e,s),t(this,"_explosionLength"),t(this,"_explosionProperties"),t(this,"_wallBuilderManager"),this.classType=G,this._explosionLength=0,this._explosionProperties=[{spriteXOffset:0,spriteYOffset:0,tileXOffset:0,tileYOffset:0,textureKey:"explosion-center"},{spriteXOffset:0,spriteYOffset:-33,tileXOffset:0,tileYOffset:-40,textureKey:"explosion-upper-lenght",textureKeyExtension:"explosion-extension-vertical"},{spriteXOffset:0,spriteYOffset:33,tileXOffset:0,tileYOffset:40,textureKey:"explosion-lower-lenght",textureKeyExtension:"explosion-extension-vertical"},{spriteXOffset:33,spriteYOffset:0,tileXOffset:40,tileYOffset:0,textureKey:"explosion-right-lenght",textureKeyExtension:"explosion-extension-horizontal"},{spriteXOffset:-33,spriteYOffset:0,tileXOffset:-40,tileYOffset:0,textureKey:"explosion-left-lenght",textureKeyExtension:"explosion-extension-horizontal"}],this._wallBuilderManager=i,this._setUpAnimations()}_setUpAnimations(){for(const t of this._explosionProperties){const e=this.scene.anims.generateFrameNumbers(t.textureKey);this._createAnimationByData(t.textureKey,e)}const e=new Set(this._explosionProperties.filter((e=>void 0!==e.textureKeyExtension)).map((e=>e.textureKeyExtension??"")));for(const t of e){const e=this.scene.anims.generateFrameNumbers(t);this._createAnimationByData(t,e)}}_createAnimationByData(e,t){this.scene.anims.exists(e)||this.scene.anims.create({key:e,frames:t,frameRate:12,yoyo:!0})}addNewExplosion(e,t){for(const s of this._explosionProperties){const i={spriteX:e+s.spriteXOffset,spriteY:t+s.spriteYOffset,tileX:e+s.tileXOffset,tileY:t+s.tileYOffset};if(this._addExplosionExtension(i,s)){const e=0===s.tileXOffset&&0===s.tileYOffset;this._addExplosionSprite(i,s.textureKey,e)}}this.scene.sound.play("explosion")}_addExplosionExtension(e,t){if(t.textureKeyExtension)for(let s=0;s<this._explosionLength;s++){if(!this._addExplosionSprite(e,t.textureKeyExtension,!1))return!1;e.spriteX+=t.spriteXOffset,e.spriteY+=t.spriteYOffset,e.tileX+=t.tileXOffset,e.tileY+=t.tileYOffset}return!0}_addExplosionSprite(e,t,s){let i=this._isBusyPosition(e);s&&(i=!1);const a=new G({scene:this.scene,x:e.spriteX,y:e.spriteY,textureKey:t,isVisible:!i});return this.add(a,!0),!i}_isBusyPosition(e){return!this._wallBuilderManager.isPositionFree(e.tileX,e.tileY)}get explosionLength(){return this._explosionLength}set explosionLength(e){this._explosionLength=e}}var D=(e=>(e[e.GAME=0]="GAME",e[e.PUT_BOMB=1]="PUT_BOMB",e[e.EXPLOIT_BOMB=2]="EXPLOIT_BOMB",e))(D||{});class R extends s.Physics.Arcade.StaticGroup{constructor({world:e,scene:s,wallBuilderManager:i}){super(e,s),t(this,"_timers"),t(this,"_maxAmountBombs"),t(this,"_isActiveRemoteControl"),t(this,"_timePutBomb"),t(this,"_timeExplosion"),t(this,"_explosionGroup"),t(this,"_wallBuilderManager"),this.classType=U,this._timers=new Map,this._maxAmountBombs=1,this._isActiveRemoteControl=!1,this._timePutBomb=0,this._timeExplosion=2,this._explosionGroup=new C({world:this.world,scene:this.scene,wallBuilderManager:i}),this._wallBuilderManager=i}putBomb(e,t){if(this._canPutBomb(e,t)){this.scene.sound.play("put-bomb");const s=new U({scene:this.scene,x:e,y:t});this.add(s,!0),this._wallBuilderManager.deletePositionFree(e,t),this.isActiveRemoteControl||this._setExplodeBombTimer(s),this._setPutBombTimer()}}exploitByBomb(e){this._exploitBomb(e)}exploitNextBomb(){if(this._canExploitBomb()){const e=this.getFirstAlive();this._exploitBomb(e)}}_exploitBomb(e){if(e.body){const t=Math.floor(e.body.center.x),s=Math.floor(e.body.center.y),i=new Phaser.Time.TimerEvent({delay:400,callback:()=>{this._wallBuilderManager.addPositionFree(t,s)},callbackScope:this});this.scene.time.addEvent(i),this._explosionGroup.addNewExplosion(t,s),e.destroy(!0)}}_setPutBombTimer(){const e=new Phaser.Time.TimerEvent({delay:1e3,repeat:this._timePutBomb,callbackScope:this});this.scene.time.addEvent(e),this._timers.set(D.PUT_BOMB,e)}_setExplodeBombTimer(e){const t=new Phaser.Time.TimerEvent({delay:1e3,repeat:this._timeExplosion,callback:()=>{const{repeatCount:s}=t;s<=0&&this._exploitBomb(e)},callbackScope:this});this.scene.time.addEvent(t)}_canPutBomb(e,t){const s=this._timers.get(D.PUT_BOMB);return!!this._wallBuilderManager.isPositionFree(e,t)&&(void 0===s||0===(null==s?void 0:s.repeatCount))&&this.getTotalUsed()<this._maxAmountBombs}_canExploitBomb(){return this._isActiveRemoteControl&&this.getTotalUsed()>0}get explosionGroup(){return this._explosionGroup}get maxAmountBombs(){return this._maxAmountBombs}set maxAmountBombs(e){this._maxAmountBombs=e}get isActiveRemoteControl(){return this._isActiveRemoteControl}set isActiveRemoteControl(e){this._isActiveRemoteControl=e}}var F=(e=>(e[e.UP=0]="UP",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN",e))(F||{});class I{constructor(e,s){t(this,"_player"),t(this,"_enemyBody"),t(this,"_direction"),t(this,"_directions"),t(this,"_retracedMotions"),t(this,"_MAX_RETRACED_MOTIONS"),this._player=e,this._enemyBody=s,this._direction=F.LEFT,this._directions=[F.LEFT,F.RIGHT,F.UP,F.DOWN],this._retracedMotions=0,this._MAX_RETRACED_MOTIONS=5}computeNewDirection(){throw new Error("Method not implemented.")}_getOppositeDirection(e){switch(e){case F.LEFT:return F.RIGHT;case F.RIGHT:return F.LEFT;case F.UP:return F.DOWN;case F.DOWN:return F.UP;default:throw new Error("Direction type is invalid")}}_getRndDirectionByExclusion(e){const t=this._directions.filter((t=>t!==e));return t[Phaser.Math.RND.between(0,t.length-1)]}retraceMotion(){const e=this._getOppositeDirection(this._direction);if(this._retracedMotions>=this._MAX_RETRACED_MOTIONS)return this._direction=this._getRndDirectionByExclusion(e),void(this._retracedMotions=0);void 0!==e&&(this._direction=e,this._retracedMotions++)}validateCrossroadOverlap(e,t){var s,i,a,o;if(0===(null==(s=this._enemyBody)?void 0:s.velocity.x)&&0===(null==(i=this._enemyBody)?void 0:i.velocity.y))return!1;const n={x:e.x??0,y:e.y??0};if(t&&t.x===(null==n?void 0:n.x)&&t.y===(null==n?void 0:n.y))return!1;const r={x:(null==(a=this._enemyBody)?void 0:a.center.x)??0,y:(null==(o=this._enemyBody)?void 0:o.center.y)??0},h=Math.round(r.x),l=Math.round(r.y),c=Math.floor(t.x),d=Math.floor(t.y),p=Math.abs(h-c),m=Math.abs(l-d);return p<=5&&m<=5}get direction(){return this._direction}set direction(e){this._direction=e}get directions(){return this._directions}get retracedMotions(){return this._retracedMotions}set retracedMotions(e){this._retracedMotions=e}get player(){return this._player}get enemyBody(){return this._enemyBody}}class N extends I{constructor(e,t){super(e,t)}computeNewDirection(){this.retracedMotions=0;const e=Phaser.Math.RND.between(0,this.directions.length-1);this.direction=this.directions[e]}}class k extends I{constructor(e,t){super(e,t)}computeNewDirection(){if(this.enemyBody&&this.player.body){this.retracedMotions=0;const e=Math.round(this.player.body.center.x),t=Math.round(this.player.body.center.y),s=e-Math.round(this.enemyBody.center.x),i=t-Math.round(this.enemyBody.center.y);if(Math.abs(s)>Math.abs(i))return void(this.direction=s>0?F.RIGHT:F.LEFT);if(Math.abs(i)>Math.abs(s))return void(this.direction=i>0?F.DOWN:F.UP);0!==s&&(this.direction=s>0?F.RIGHT:F.LEFT),0!==i&&(this.direction=i>0?F.DOWN:F.UP)}}}var W=(e=>(e[e.FIRST_LEVEL=0]="FIRST_LEVEL",e[e.SECOND_LEVEL=1]="SECOND_LEVEL",e))(W||{});class K{static getInstance({type:e,player:t,enemyBody:s}){switch(e){case W.FIRST_LEVEL:return new N(t,s);case W.SECOND_LEVEL:return new k(t,s)}}}class V extends s.Physics.Arcade.Sprite{constructor({scene:e,x:s,y:i,enemyData:a,hasTemporalShield:o,player:n}){super(e,s,i,a.textureKey),t(this,"_enemyData"),t(this,"_player"),t(this,"_animLeftKey"),t(this,"_animRightKey"),t(this,"_animDeadKey"),t(this,"_hasTemporalShield"),t(this,"_mapCrossroadOffset"),t(this,"_lastCrossroadTouched"),t(this,"_motionManager"),e.physics.add.existing(this),this._enemyData=a,this._player=n,this._animLeftKey=`${this._enemyData.type}-left`,this._animRightKey=`${this._enemyData.type}-right`,this._animDeadKey=`${this._enemyData.type}-dead`,this._hasTemporalShield=o,this._mapCrossroadOffset=50,this._lastCrossroadTouched={x:s,y:i},this.setScale(2),this._setUpTemporalShield()}_setUpTemporalShield(){if(this._hasTemporalShield){const e=new Phaser.Time.TimerEvent({delay:100,repeat:40,callback:()=>{const{repeatCount:t}=e;this.setVisible(!this.visible),t<=0&&(this.setVisible(!0),this._hasTemporalShield=!1)},callbackScope:this});this.scene.time.addEvent(e)}}_updateSpriteMotion(e){var t,s;if(null==(t=this.body)?void 0:t.enable)switch(null==(s=this._motionManager)?void 0:s.direction){case F.LEFT:this.play(this._animLeftKey),this.scene.physics.moveTo(this,e.x-this._mapCrossroadOffset,e.y,this._enemyData.velocity);break;case F.RIGHT:this.play(this._animRightKey),this.scene.physics.moveTo(this,e.x+this._mapCrossroadOffset,e.y,this._enemyData.velocity);break;case F.DOWN:this.play(this._animLeftKey),this.scene.physics.moveTo(this,e.x,e.y+this._mapCrossroadOffset,this._enemyData.velocity);break;case F.UP:this.play(this._animRightKey),this.scene.physics.moveTo(this,e.x,e.y-this._mapCrossroadOffset,this._enemyData.velocity)}}setMotionManager(e){this._motionManager=K.getInstance({type:e,player:this._player,enemyBody:this.body})}dispatchMotion(){var e;this.setVelocity(0),this._lastCrossroadTouched&&(this.setPosition(this._lastCrossroadTouched.x,this._lastCrossroadTouched.y),null==(e=this._motionManager)||e.computeNewDirection(),this._updateSpriteMotion({x:this._lastCrossroadTouched.x,y:this._lastCrossroadTouched.y}))}retraceMotion(){var e,t,s;this.setVelocity(0),this.body&&(null==(e=this._motionManager)||e.retraceMotion(),this._updateSpriteMotion({x:null==(t=this.body)?void 0:t.center.x,y:null==(s=this.body)?void 0:s.center.y}))}validateCrossroadOverlap(e){var t,s;return!(!this._motionManager||!this._lastCrossroadTouched)&&this._motionManager.validateCrossroadOverlap({x:null==(t=this._lastCrossroadTouched)?void 0:t.x,y:null==(s=this._lastCrossroadTouched)?void 0:s.y},e)}kill(){this.disableBody(!1),this.setImmovable(!0),this.play(this._animDeadKey).once(s.Animations.Events.ANIMATION_COMPLETE,(()=>{this.play("destroy-enemy").once(s.Animations.Events.ANIMATION_COMPLETE,(()=>{var e,t;if(this.body){const s=this.scene.add.text(null==(e=this.body)?void 0:e.center.x,null==(t=this.body)?void 0:t.center.y,this.enemyData.rewardPoints.toString()).setFontFamily('"BitBold", "Tahoma"').setFontSize(10).setColor("white").setStroke("black",2.5);this.scene.time.addEvent({delay:2e3,callback:()=>s.destroy(!0),callbackScope:this})}this.destroy(!0)}))}))}get enemyData(){return this._enemyData}get lastCrossroadTouched(){return this._lastCrossroadTouched}set lastCrossroadTouched(e){this._lastCrossroadTouched=e}get hasTemporalShield(){return this._hasTemporalShield}}var H=(e=>(e.BALLOM="ballom",e.ONIL="onil",e.MINVO="minvo",e.DAHL="dahl",e.OVAPE="ovape",e.PONTAN="pontan",e.PASS="pass",e))(H||{}),X=(e=>(e[e.BOMB_UP=0]="BOMB_UP",e[e.FIRE_UP=1]="FIRE_UP",e[e.SPEED_UP=2]="SPEED_UP",e[e.REMOTE_CONTROL=3]="REMOTE_CONTROL",e[e.WALL_PASS=4]="WALL_PASS",e[e.BOMB_PASS=5]="BOMB_PASS",e[e.FLAME_PASS=6]="FLAME_PASS",e))(X||{});const z=()=>[{stage:o.ONE,powerUp:X.SPEED_UP,enemies:[{quantity:4,type:H.BALLOM}]},{stage:o.TWO,powerUp:X.FIRE_UP,enemies:[{quantity:2,type:H.BALLOM},{quantity:3,type:H.ONIL}]},{stage:o.THREE,powerUp:X.REMOTE_CONTROL,enemies:[{quantity:2,type:H.BALLOM},{quantity:3,type:H.ONIL},{quantity:1,type:H.DAHL}]},{stage:o.FOUR,powerUp:X.FLAME_PASS,enemies:[{quantity:2,type:H.BALLOM},{quantity:3,type:H.DAHL},{quantity:2,type:H.MINVO}]},{stage:o.FIVE,enemies:[{quantity:4,type:H.MINVO},{quantity:3,type:H.OVAPE},{quantity:1,type:H.PASS}]},{stage:o.FINAL_BONUS,powerUp:X.FLAME_PASS,enemies:[{quantity:20,type:H.PONTAN}]}];class Y extends s.Physics.Arcade.Group{constructor({world:e,scene:s,wallBuilderManager:i,player:a,savedGame:o,gameStage:n}){super(e,s),t(this,"_enemyLevel"),t(this,"_wallBuilderManager"),t(this,"_player"),t(this,"_savedGame"),t(this,"_gameStage"),this._enemyLevel=this._getEnemyLevelByKey(n.stage),this._wallBuilderManager=i,this._player=a,this._gameStage=n,this._savedGame=o,this.classType=V,this._setUp()}_getEnemyLevelByKey(e){const t=z(),s=t.find((t=>t.stage===e));return void 0===s?t[0].enemies:s.enemies}_getEnemyDataByKey(e){const t=[{type:H.BALLOM,textureKey:"ballom",velocity:30,hasWallPassPowerUp:!1,rewardPoints:100,motionEnemyType:W.FIRST_LEVEL},{type:H.ONIL,textureKey:"onil",velocity:65,hasWallPassPowerUp:!1,rewardPoints:150,motionEnemyType:W.FIRST_LEVEL},{type:H.MINVO,textureKey:"minvo",velocity:100,hasWallPassPowerUp:!1,rewardPoints:200,motionEnemyType:W.FIRST_LEVEL},{type:H.DAHL,textureKey:"dahl",velocity:70,hasWallPassPowerUp:!1,rewardPoints:250,motionEnemyType:W.FIRST_LEVEL},{type:H.OVAPE,textureKey:"ovape",velocity:50,hasWallPassPowerUp:!0,rewardPoints:300,motionEnemyType:W.FIRST_LEVEL},{type:H.PASS,textureKey:"pass",velocity:95,hasWallPassPowerUp:!1,rewardPoints:350,motionEnemyType:W.FIRST_LEVEL},{type:H.PONTAN,textureKey:"pontan",velocity:120,hasWallPassPowerUp:!0,rewardPoints:400,motionEnemyType:W.SECOND_LEVEL}],s=t.find((t=>t.type===e));return void 0===s?t[0]:s}_setUp(){this._gameStage.status===n.LOADED_GAME&&this._savedGame?this._createEnemiesFromData(this._savedGame.enemies):this._createEnemies(),this._setUpAnimations()}_createEnemies(){for(const e of this._enemyLevel){const t=this._getEnemyDataByKey(e.type);this._createAnimationByEnemy(t);for(let s=0;s<e.quantity;s++){const{element:e}=this._wallBuilderManager.pickSafeRndFreePosition();this._createNewEnemy(e,t,!1)}}}_createEnemiesFromData(e){for(const t of e){const e=this._getEnemyDataByKey(t.enemyData.type);this._createAnimationByEnemy(e);const{x:s,y:i}=t;this._createNewEnemy({x:s,y:i},e,!1)}}_setUpAnimations(){if(void 0===this._enemyLevel.find((e=>e.type===H.PONTAN))){const e=this._getEnemyDataByKey(H.PONTAN);this._createAnimationByEnemy(e)}this.scene.anims.exists("destroy-enemy")||this.scene.anims.create({key:"destroy-enemy",frames:this.scene.anims.generateFrameNumbers("destroy-enemy"),frameRate:3,delay:2e3})}_createAnimationByEnemy(e){const{type:t}=e,s=t===H.PONTAN?[0,1,2,3,4]:[0,1,2],i=t===H.PONTAN?[7,8,9,10,11]:[4,5,6],a=t===H.PONTAN?[Phaser.Math.RND.between(5,6)]:[3];this.scene.anims.exists(`${t}-left`)||this.scene.anims.create({key:`${t}-left`,frames:this.scene.anims.generateFrameNumbers(e.textureKey,{frames:s}),frameRate:6,repeat:-1}),this.scene.anims.exists(`${t}-right`)||this.scene.anims.create({key:`${t}-right`,frames:this.scene.anims.generateFrameNumbers(e.textureKey,{frames:i}),frameRate:6,repeat:-1}),this.scene.anims.exists(`${t}-dead`)||this.scene.anims.create({key:`${t}-dead`,frames:this.scene.anims.generateFrameNumbers(e.textureKey,{frames:a}),frameRate:6})}_createNewEnemy(e,t,s){const i=new V({scene:this.scene,x:e.x,y:e.y,enemyData:t,hasTemporalShield:s,player:this._player});this.add(i,!0),i.setMotionManager(t.motionEnemyType),i.dispatchMotion()}_getEnemiesPosition(){const e=[];if(this.getTotalUsed()>0)return this.getChildren().forEach((t=>{var s,i;const a=t;a.setImmovable(!0),e.push({x:Math.floor((null==(s=a.body)?void 0:s.center.x)??0),y:Math.floor((null==(i=a.body)?void 0:i.center.y)??0)})})),e;for(let t=0;t<7;t++){const{element:t}=this._wallBuilderManager.pickSafeRndFreePosition();e.push({x:t.x,y:t.y})}return e}addRandomByPosition(e,t){const s=Phaser.Math.RND.between(3,6),i=this._enemyLevel[this._enemyLevel.length-1],a=this._getEnemyDataByKey(i.type);for(let o=0;o<s;o++)this._createNewEnemy({x:e,y:t},a,!0)}replaceAllByType(e){const t=this._getEnemyDataByKey(e);this.clear(!0,!0);const s=this._getEnemiesPosition();for(const i of s)this._createNewEnemy(i,t,!1)}getSavedState(){return this.getChildren().map((e=>{var t,s;const i=e;return{x:Math.round((null==(t=i.body)?void 0:t.center.x)??0),y:Math.round((null==(s=i.body)?void 0:s.center.y)??0),enemyData:i.enemyData}}))}}class j{constructor({scene:e,gameStage:s,player:i,enemiesGroup:a}){t(this,"_scene"),t(this,"_gameStage"),t(this,"_player"),t(this,"_enemiesGroup"),t(this,"_labels"),t(this,"_timers"),this._scene=e,this._gameStage=s,this._player=i,this._enemiesGroup=a,this._labels=this._scene.add.group(),this._timers=new Map,this._setUp()}_setUp(){const e={font:"15px BitBold",fill:"white",stroke:"black",strokeThickness:2.5};let t=22;const s=this._scene.add.text(t,22,`TIME ${this._gameStage.time}`,e);s.setScrollFactor(0,0),s.name="TIME",this._labels.add(s),t+=170;const i=this._scene.add.text(t,22,this._gameStage.stageScore.toString(),e);i.setScrollFactor(0,0),i.name="SCORE",this._labels.add(i),t+=128;const a=this._scene.add.text(t,22,`LEFT ${this._gameStage.lives}`,e);a.setScrollFactor(0,0),a.name="LEFT",this._labels.add(a);const o=new Phaser.Time.TimerEvent({delay:1e3,repeat:this._gameStage.time,callback:()=>{const{repeatCount:e}=o;e<=0&&this._enemiesGroup.replaceAllByType(H.PONTAN),this._gameStage.time=e,this._setLabelTextByKey("TIME",`TIME ${e}`)},callbackScope:this});this._scene.time.addEvent(o),this._timers.set(D.GAME,o)}win(){this._scene.game.sound.stopAll(),(localStorage.getItem(l.HIGHEST_SCORE_KEY)??0)<localStorage.stage_points&&localStorage.setItem(l.HIGHEST_SCORE_KEY,localStorage.stage_points),this._player.disableBody(!1),this._player.setImmovable(!0),this._gameStage.stageScore+=450,this._gameStage.totalScore=this._gameStage.stageScore,this._gameStage.status=n.NEXT_STAGE,this._setLabelTextByKey("SCORE",this._gameStage.stageScore.toString()),this._scene.sound.play("level-complete");const e=new Phaser.Time.TimerEvent({delay:1e3,repeat:5,callback:()=>{const{repeatCount:t}=e;t<=0&&(this._gameStage.stage===o.FINAL_BONUS&&(this._gameStage.status=n.COMPLETED),this._scene.scene.start("ChangeStage",this._gameStage))},callbackScope:this});this._scene.time.addEvent(e)}lose(){const e=this._timers.get(D.GAME);e&&(e.paused=!0),this._gameStage.stageScore=0,this._player.kill();const t=new Phaser.Time.TimerEvent({delay:1e3,repeat:4,callback:()=>{const{repeatCount:e}=t;e<=0&&(this._gameStage.lives--,this._gameStage.lives>=0?this._gameStage.status=n.RESTART:this._gameStage.status=n.GAME_OVER,this._scene.scene.start("ChangeStage",this._gameStage))},callbackScope:this});this._scene.time.addEvent(t)}_setLabelTextByKey(e,t){const s=this._labels.getMatching("name",e)[0];s&&s.setText(t)}get score(){return this._gameStage.stageScore}set score(e){this._gameStage.stageScore=e,this._setLabelTextByKey("SCORE",this._gameStage.stageScore.toString())}}class $ extends s.Physics.Arcade.Sprite{constructor({scene:e,x:t,y:s}){super(e,t,s,"wall",0),this.setScale(2.5)}kill(){var e;(null==(e=this.body)?void 0:e.enable)&&(this.disableBody(!1),this.play("wall-explosion").once(s.Animations.Events.ANIMATION_COMPLETE,(()=>{this.destroy(!0)})))}}class q extends s.Physics.Arcade.StaticGroup{constructor({world:e,scene:t}){super(e,t),this.classType=$,this._setUpAnimations()}_setUpAnimations(){this.scene.anims.exists("wall-explosion")||this.scene.anims.create({key:"wall-explosion",frames:this.scene.anims.generateFrameNumbers("wall-explosion"),frameRate:12})}}var J=(e=>(e[e.ISOLATED=0]="ISOLATED",e[e.ROW=1]="ROW",e[e.COLUMN=2]="COLUMN",e))(J||{});class Q{constructor({roads:e,crossroads:s,minWalls:i,maxWalls:a}){t(this,"_freePositions"),t(this,"_minWalls"),t(this,"_maxWalls"),t(this,"_wallTypes"),this._freePositions=[],this._minWalls=i,this._maxWalls=a,this._wallTypes=[J.ISOLATED,J.COLUMN,J.ROW],this._setUp(e,s)}_setUp(e,t){const s=[...e.map((e=>({x:e.x??0,y:e.y??0}))),...t.map((e=>({x:e.x??0,y:e.y??0})))];this._freePositions=s}_isIllegalPositions(e){return 60===e.x&&120===e.y||60===e.x&&160===e.y||100===e.x&&120===e.y}pickSafeRndFreePosition(){const e=Phaser.Math.RND.between(0,this._freePositions.length-1),t=this._freePositions[e];return this._isIllegalPositions(t)?this.pickSafeRndFreePosition():{element:t,index:e}}buildWallsFromArray(e,t){for(const s of e)t(s.x,s.y),this.deletePositionFree(s.x,s.y)}buildWalls(e){const t=Phaser.Math.RND.between(this._minWalls,this._maxWalls);let s=0;for(;s<t;){const t=Phaser.Math.RND.between(0,this._wallTypes.length-1),i=this._wallTypes[t],{element:a,index:o}=this.pickSafeRndFreePosition();switch(i){case J.ISOLATED:e(a.x,a.y),this._freePositions.splice(o,1),s++;break;case J.ROW:s+=this._allocateWallsInAxis({posWall:a,posWallsInAxis:this._freePositions.filter((e=>e.y===a.y)),addWallSpriteFn:e});break;case J.COLUMN:s+=this._allocateWallsInAxis({posWall:a,posWallsInAxis:this._freePositions.filter((e=>e.x===a.x)),addWallSpriteFn:e})}}}_allocateWallsInAxis(e){const{posWall:t,posWallsInAxis:s,addWallSpriteFn:i}=e;let a=Phaser.Math.RND.between(2,4);a>s.length&&(a=s.length);const o=s.findIndex((e=>e.x===t.x&&e.y===t.y));let n=a;for(let r=o;r<s.length&&n>0;r++)this._isIllegalPositions(s[r])||(i(s[r].x,s[r].y),this.deletePositionFree(s[r].x,s[r].y),n--);for(let r=o;r>=0&&n>0;r--)this._isIllegalPositions(s[r])||(i(s[r].x,s[r].y),this.deletePositionFree(s[r].x,s[r].y),n--);return a}isPositionFree(e,t){return this.freePositions.findIndex((s=>s.x===e&&s.y===t))>-1}addPositionFree(e,t){return this.freePositions.push({x:e,y:t})}deletePositionFree(e,t){const s=this.freePositions.findIndex((s=>s.x===e&&s.y===t));this._freePositions.splice(s,1)}get freePositions(){return this._freePositions}set freePositions(e){this._freePositions=e}}class Z{constructor({scene:e,world:s,gameStage:i,savedGame:a}){t(this,"_scene"),t(this,"_world"),t(this,"_map"),t(this,"_mapLayer"),t(this,"_wallBuilderManager"),t(this,"_wallsGroup"),t(this,"_roads"),t(this,"_crossroads"),t(this,"_DEFAULT_MIN_WALLS"),t(this,"_DEFAULT_MAX_WALLS"),t(this,"_powerUp"),t(this,"_door"),t(this,"_savedGame"),t(this,"_gameStage"),this._scene=e,this._world=s,this._gameStage=i,this._savedGame=a,this._DEFAULT_MIN_WALLS=45,this._DEFAULT_MAX_WALLS=60,this._scene.cameras.main.backgroundColor=Phaser.Display.Color.HexStringToColor("#1F8B00"),this._createMap()}_createMap(){const e=this._createMapLayer();if(null===e)throw new Error("Map Layer is null to continue");this._map=e._map,this._mapLayer=e._mapLayer,this._setUpWalls(),this._setUpCrossroads(),this._setUpSpecialObjects(),this._setUpMusic(),this._scene.cameras.main.setBounds(0,0,this._map.widthInPixels,this._map.heightInPixels)}_createMapLayer(){const e=this._scene.add.tilemap("world"),t=e.addTilesetImage("tilemap");if(t){const s=e.createLayer("Map",t);if(s)return s.setCollisionByExclusion([-1]),{_map:e,_mapLayer:s}}return null}_setUpWalls(){var e,t;const s=(null==(e=this._map.objects.find((e=>"Roads"===e.name)))?void 0:e.objects)??[],i=(null==(t=this._map.objects.find((e=>"Crossroads"===e.name)))?void 0:t.objects)??[],{minWalls:a,maxWalls:o}=this._getAverageWalls();this._wallBuilderManager=new Q({roads:s,crossroads:i,minWalls:a,maxWalls:o}),this._wallsGroup=new q({scene:this._scene,world:this._world}),this._validateSavedWalls(((e,t)=>{this._wallsGroup.add(new $({scene:this._scene,x:e,y:t}),!0)}))}_validateSavedWalls(e){this._gameStage.status===n.LOADED_GAME&&this._savedGame?this._wallBuilderManager.buildWallsFromArray(this._savedGame.map.walls,e):this._wallBuilderManager.buildWalls(e)}_getAverageWalls(){return this._gameStage.stage===o.FINAL_BONUS?{minWalls:0,maxWalls:0}:{minWalls:this._DEFAULT_MIN_WALLS,maxWalls:this._DEFAULT_MAX_WALLS}}_setUpCrossroads(){this._crossroads=this._setUpTileGroup("Crossroads"),this._roads=this._setUpTileGroup("Roads")}_setUpTileGroup(e){const t=this._scene.physics.add.group(),i=this._map.createFromObjects(e,{classType:s.Physics.Arcade.Image});return t.addMultiple(i).setVisible(!1).scaleXY(1.2,1.2)}_setUpSpecialObjects(){this._gameStage.stage!==o.FINAL_BONUS&&(this._setUpDoor(),this._setUpPowerUp())}_setUpDoor(){const e=this._getPositionByObject("door","hasDoor");this._door=this._scene.physics.add.image(e.x,e.y,"door").setScale(2.5).setVisible(this._getVisibilityByObject("door"))}_setUpPowerUp(){const e=this._getPowerUp(),t=this._getPositionByObject("powerUp","hasPowerUp");this._powerUp=this._scene.physics.add.image(t.x,t.y,e.textureKey).setScale(2.5).setData("powerUpId",e.id).setVisible(this._getVisibilityByObject("powerUp"))}_getPositionByObject(e,t){if(this._gameStage.status===n.LOADED_GAME&&this._savedGame){const s=this._savedGame.map[e];if(!s.isVisible){const e=this.wallsGroup.getChildren().find((e=>{var t,i;const a=e;return Math.floor((null==(t=a.body)?void 0:t.center.x)??0)===s.x&&Math.floor((null==(i=a.body)?void 0:i.center.y)??0)===s.y}));e&&e.setData(t,!0)}return{x:s.x,y:s.y}}const s=this._pickSafeRndWall();return s.setData(t,!0),{x:s.x,y:s.y}}_getVisibilityByObject(e){return!(this._gameStage.status!==n.LOADED_GAME||!this._savedGame)&&this._savedGame.map[e].isVisible}_getPowerUp(){const e=z(),t=[{id:X.BOMB_UP,textureKey:"bomb-up"},{id:X.FIRE_UP,textureKey:"fire-up"},{id:X.FLAME_PASS,textureKey:"flame-pass"},{id:X.REMOTE_CONTROL,textureKey:"remote-control"},{id:X.SPEED_UP,textureKey:"speed-up"},{id:X.WALL_PASS,textureKey:"wall-pass"}];let s=e.find((e=>e.stage===this._gameStage.stage));return void 0===s&&(s=e[0]),t.find((e=>e.id===s.powerUp))??t[0]}_pickSafeRndWall(){const e=Phaser.Math.RND.between(0,this.wallsGroup.getLength()-1),t=this.wallsGroup.getChildren()[e];return t.getData("hasPowerUp")||t.getData("hasDoor")?this._pickSafeRndWall():t}_setUpMusic(){const e=this._gameStage.stage===o.FINAL_BONUS?"bonus-theme":"stage-theme";this._scene.sound.play(e,{loop:!0,volume:.5})}getSavedState(){var e,t,s,i;return{walls:this.wallsGroup.getChildren().map((e=>{var t,s;const i=e;return{x:Math.round((null==(t=i.body)?void 0:t.center.x)??0),y:Math.round((null==(s=i.body)?void 0:s.center.y)??0)}})),door:{x:Math.round((null==(e=this.door.body)?void 0:e.center.x)??0),y:Math.round((null==(t=this.door.body)?void 0:t.center.y)??0),isVisible:this.door.visible},powerUp:{x:Math.round((null==(s=this.powerUp.body)?void 0:s.center.x)??0),y:Math.round((null==(i=this.powerUp.body)?void 0:i.center.y)??0),isVisible:this.powerUp.visible}}}get map(){return this._map}get mapLayer(){return this._mapLayer}get wallsGroup(){return this._wallsGroup}get crossroads(){return this._crossroads}get roads(){return this._roads}get wallBuilderManager(){return this._wallBuilderManager}get door(){return this._door}get powerUp(){return this._powerUp}}class ee{constructor({scene:e,player:s,bombGroup:i,gameStage:a}){t(this,"_player"),t(this,"_bombGroup"),t(this,"_scene"),t(this,"_gameStage"),this._scene=e,this._player=s,this._bombGroup=i,this._gameStage=a,this._setUp()}_setUp(){for(const e of this._gameStage.powerUps)this._enablePowerUp(e)}addPowerUp(e){return this._scene.sound.stopByKey("stage-theme"),this._scene.sound.play("power-up"),this._scene.sound.play("find-the-door",{loop:!0}),this._gameStage.powerUps.push(e),this._enablePowerUp(e)}_enablePowerUp(e){switch(e){case X.BOMB_UP:return this._bombGroup.maxAmountBombs++,100;case X.FIRE_UP:return this._bombGroup.explosionGroup.explosionLength++,150;case X.SPEED_UP:return this._player.speed+=20,200;case X.REMOTE_CONTROL:return this._bombGroup.isActiveRemoteControl=!0,250;case X.WALL_PASS:return this._player.hasWallPassPowerUp=!0,300;case X.BOMB_PASS:return this._player.hasBombPassPowerUp=!0,350;case X.FLAME_PASS:return this._player.hasFlamePassPowerUp=!0,400;default:throw new Error("Power Up invalid")}}}class te extends s.Scene{constructor(){super("Game"),t(this,"_gameStage"),t(this,"_savedGame"),t(this,"_gameRulesManager"),t(this,"_mapManager"),t(this,"_powerUpManager"),t(this,"_saveGameManager"),t(this,"_player"),t(this,"_bombGroup"),t(this,"_enemiesGroup"),this._savedGame=null}init(e){this._gameStage=e,this._savedGame=c.getLoadedGame()}create(){this._mapManager=new Z({scene:this,world:this.physics.world,gameStage:this._gameStage,savedGame:this._savedGame}),this._bombGroup=new R({scene:this,world:this.physics.world,wallBuilderManager:this._mapManager.wallBuilderManager}),this._player=new L({scene:this,x:60,y:120,bombGroup:this._bombGroup,gameStage:this._gameStage,savedGame:this._savedGame}),this._enemiesGroup=new Y({scene:this,world:this.physics.world,player:this._player,wallBuilderManager:this._mapManager.wallBuilderManager,gameStage:this._gameStage,savedGame:this._savedGame}),this._powerUpManager=new ee({scene:this,player:this._player,bombGroup:this._bombGroup,gameStage:this._gameStage}),this._gameRulesManager=new j({scene:this,gameStage:this._gameStage,player:this._player,enemiesGroup:this._enemiesGroup}),this._saveGameManager=new c({scene:this,gameStage:this._gameStage,player:this._player,enemiesGroup:this._enemiesGroup,mapManager:this._mapManager}),this.physics.add.collider(this._player,this._mapManager.mapLayer),this.physics.add.collider(this._player,this._bombGroup,void 0,((e,t)=>!e.hasBombPassPowerUp),this),this.physics.add.collider(this._player,this._mapManager.wallsGroup,void 0,((e,t)=>!e.hasWallPassPowerUp),this),this.physics.add.overlap(this._player,this._mapManager.crossroads,((e,t)=>{const s=t;s.body&&(this._player.lastTilePassedPosition={x:Math.floor(s.body.center.x),y:Math.floor(s.body.center.y)})}),((e,t)=>{const s=t;return this._player.validateTileOverlap(s)}),this),this.physics.add.overlap(this._player,this._mapManager.roads,((e,t)=>{const s=t;s.body&&(this._player.lastTilePassedPosition={x:Math.floor(s.body.center.x),y:Math.floor(s.body.center.y)})}),((e,t)=>{const s=t;return this._player.validateTileOverlap(s)}),this),this.physics.add.overlap(this._player,this._enemiesGroup,(()=>{this._gameRulesManager.lose()}),void 0,this),this.physics.add.overlap(this._player,this._bombGroup.explosionGroup,(()=>{this._gameRulesManager.lose()}),(()=>!this._player.hasFlamePassPowerUp),this),this.physics.add.collider(this._enemiesGroup,this._bombGroup,((e,t)=>{e.retraceMotion()}),void 0,this),this.physics.add.collider(this._enemiesGroup,this._mapManager.mapLayer,((e,t)=>{e.retraceMotion()}),void 0,this),this.physics.add.collider(this._enemiesGroup,this._mapManager.wallsGroup,((e,t)=>{e.retraceMotion()}),((e,t)=>!e.enemyData.hasWallPassPowerUp),this),this.physics.add.overlap(this._enemiesGroup,this._mapManager.crossroads,((e,t)=>{var s,i;const a=t,o=e,n={x:(null==(s=a.body)?void 0:s.center.x)??0,y:(null==(i=a.body)?void 0:i.center.y)??0};o.lastCrossroadTouched={x:n.x,y:n.y},o.dispatchMotion()}),((e,t)=>{var s,i;const a=e,o=t,n={x:(null==(s=o.body)?void 0:s.center.x)??0,y:(null==(i=o.body)?void 0:i.center.y)??0};return a.validateCrossroadOverlap({x:n.x,y:n.y})}),this),this.physics.add.overlap(this._bombGroup.explosionGroup,this._bombGroup,((e,t)=>{const s=t;this._bombGroup.exploitByBomb(s)}),void 0,this),this.physics.add.overlap(this._player,this._mapManager.powerUp,((e,t)=>{const s=t,i=s.getData("powerUpId"),a=this._powerUpManager.addPowerUp(i);this._gameRulesManager.score+=a,s.destroy()}),((e,t)=>{const s=e,i=t;if(s.body&&i.body){const e=Math.round(s.body.center.x),t=Math.round(s.body.center.y),a=Math.floor(i.body.center.x),o=Math.floor(i.body.center.y),n=Math.abs(e-a),r=Math.abs(t-o);return n<=5&&r<=5}return!1}),this),this.physics.add.overlap(this._player,this._mapManager.door,(()=>{this._gameRulesManager.win()}),((e,t)=>{const s=e,i=t;if(s.body&&i.body){const e=Math.round(s.body.center.x),t=Math.round(s.body.center.y),a=Math.floor(i.body.center.x),o=Math.floor(i.body.center.y),n=Math.abs(e-a),r=Math.abs(t-o);return console.log(n),console.log(r),n<=15&&r<=15}return!0}),this),this.physics.add.overlap(this._bombGroup.explosionGroup,this._mapManager.door,(()=>{const e=this._mapManager.door;e.disableBody(!1),setTimeout((()=>{e.enableBody(!1)}),3e3),e.body&&this._enemiesGroup.addRandomByPosition(e.body.center.x,e.body.center.y)}),(()=>{var e;const t=this._mapManager.door;return(null==(e=t.body)?void 0:e.enable)&&t.visible}),this),this.physics.add.overlap(this._bombGroup.explosionGroup,this._enemiesGroup,((e,t)=>{const s=t;s.kill(),this._gameRulesManager.score+=s.enemyData.rewardPoints,0===this._enemiesGroup.getTotalUsed()&&this._gameStage.stage===o.FINAL_BONUS&&this._gameRulesManager.win()}),((e,t)=>!t.hasTemporalShield),this),this.physics.add.collider(this._bombGroup.explosionGroup,this._mapManager.wallsGroup,((e,t)=>{const s=t;if(s.kill(),s.getData("hasDoor")){const e=this._mapManager.door;e.disableBody(!1),setTimeout((()=>{e.enableBody(!1)}),3e3),e.setVisible(!0)}if(s.getData("hasPowerUp")&&this._mapManager.powerUp.setVisible(!0),s.body){const e=Math.floor(s.body.center.x),t=Math.floor(s.body.center.y);this._mapManager.wallBuilderManager.addPositionFree(e,t)}}),void 0,this)}update(){this._player.addControlsListener(),this._saveGameManager.addControlsListener()}}const se={type:s.AUTO,width:1024,height:580,parent:"bomberman-container",backgroundColor:"#000000",antialias:!0,physics:{default:"arcade"},scene:[i,a,d,O,te]};new s.Game(se);
